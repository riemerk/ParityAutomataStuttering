As seen in the examples of last week we have a construction to obtain an automaton that recognizes the stuttter closure of a language. I informally introduced the procedures but now I will give a formal definition of the automaton $\A^s$. Later on I will prove that this indeed recognizes the stutter-closure.
\begin{definition}\label{def:stutterclosed}
Let \(\A = (Q, \Sigma, \delta, q_I, \Omega)\) be some NPA, where without loss of generality we assume that $\Sigma \cap \omega = \emptyset$. We will define it's \textbf{Stutter-closed automaton} \(\mathbb{A}^s = (Q', \Sigma, \delta', q_I', \Omega')\) as follows:\\
First define the new set of states $Q'$ as $Q' := Q\times \Omega(Q) \cup Q\times \Sigma$ and the set of initial states $q_I'$ as $q_I':=\{(q, \Omega(q))|q\in q_I\}$. To define the transition function $\delta'$ let $(q,a)\in Q'$\\
\textbf{Case 1: $a\in \Sigma$}:
\[
 \delta'((q, a), b) = \begin{cases}
                       \{(q, a), (q, \Omega(q))\}&\text{if } a = b\\
                      \emptyset & \text{else}
                      \end{cases}
\]
\textbf{Case 2: $a\in \Omega(Q)$}:
\begin{align*}
 \delta'((q, a), b) &= \{(q', \Omega(q'))\in Q \times \Omega(Q)\mid q'\in \delta(q, b)\}\\ &\text{\textcolor{red}{dit is eigenlijk overbodig want wordt ook gevangen in laatste case met $n=1$}}\\
                    &\cup \{(q', b)\in Q\times \Sigma\mid  q'\in \delta(q, b)\}\\
                    &\cup \{(q', p) \in Q\times \Omega(Q)\mid \exists n, \exists \rho (qq_1\dots q_{n-1}q') \land q\stackrel{b^n}{\twoheadrightarrow^\rho}q'\land\\
                    & p = \max\{\max(\Omega(q_i), q')\mid i\in \{1, \dots, n-1\}\} \}
\end{align*}
Lastly we define the parity map $\Omega'$ as following:
\[
 \Omega'(q) =\left\{\begin{array}{llll}
             p + 2 &\text{ if } q=(q', p)   &\text{with } p\in \omega\\
             1 &\text{ if } q = (q', l) &\text{with } l\in \Sigma
            \end{array}\right.
\]
\end{definition}
